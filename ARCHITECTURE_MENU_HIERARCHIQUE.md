# üìä ARCHITECTURE DES MENUS HI√âRARCHIQUES

**Date**: 31 octobre 2025  
**Version**: 1.0  
**Projet**: SANTE.GA - Syst√®me de navigation multi-√©tablissements et multi-r√¥les

---

## üéØ OBJECTIF

Impl√©menter une navigation hi√©rarchique o√π les professionnels doivent :
1. **S√©lectionner un √©tablissement**
2. **Choisir un r√¥le** (si plusieurs disponibles)
3. **Acc√©der au menu contextuel** adapt√© √† leur r√¥le et type d'√©tablissement

---

## üìê ARCHITECTURE IMPL√âMENT√âE

### 1. Flux de Navigation

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Connexion    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ S√©lection √âtablissement‚îÇ ‚Üê /professional/establishments
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   S√©lection R√¥le       ‚îÇ ‚Üê /professional/select-role/:establishmentId
‚îÇ  (ADMIN ou M√âDECIN)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Dashboard avec Menu   ‚îÇ ‚Üê /professional/dashboard
‚îÇ     Contextuel         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Structure des Fichiers

```
src/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ menuDefinitions.ts       # ‚≠ê D√©finitions des menus par type/r√¥le
‚îÇ
‚îú‚îÄ‚îÄ pages/professional/
‚îÇ   ‚îî‚îÄ‚îÄ SelectRole.tsx           # ‚≠ê Page de s√©lection du r√¥le
‚îÇ
‚îú‚îÄ‚îÄ components/layout/
‚îÇ   ‚îú‚îÄ‚îÄ RoleAndEstablishmentSwitcher.tsx  # ‚≠ê Composant de bascule
‚îÇ   ‚îî‚îÄ‚îÄ sidebar/
‚îÇ       ‚îî‚îÄ‚îÄ SidebarNav.tsx       # Navigation dynamique
‚îÇ
‚îî‚îÄ‚îÄ contexts/
    ‚îî‚îÄ‚îÄ MultiEstablishmentContext.tsx  # Gestion du contexte
```

---

## üìã D√âFINITIONS DES MENUS

### Structure par Type d'√âtablissement et R√¥le

```typescript
// menuDefinitions.ts

const MENU_DEFINITIONS = {
  hospital: {
    admin: {
      sections: [
        {
          title: "G√âN√âRAL",
          items: [
            { title: "Vue d'ensemble", icon: BarChart, path: "/overview", permission: "view_analytics" },
          ]
        },
        {
          title: "ADMINISTRATION",
          items: [
            { title: "Personnel", icon: Users, path: "/personnel", permission: "manage_staff" },
            { title: "Facturation", icon: DollarSign, path: "/billing", permission: "manage_billing" },
            { title: "Inventaire", icon: Package, path: "/inventory", permission: "manage_stock" },
            { title: "Rapports", icon: FileText, path: "/reports", permission: "view_analytics" }
          ]
        },
        {
          title: "COMMUNICATION",
          items: [
            { title: "Messages", icon: MessageSquare, path: "/messages", badge: 3 }
          ]
        }
      ]
    },
    doctor: {
      sections: [
        {
          title: "G√âN√âRAL",
          items: [
            { title: "Vue d'ensemble", icon: BarChart, path: "/overview" }
          ]
        },
        {
          title: "ACTIVIT√â M√âDICALE",
          items: [
            { title: "Rendez-vous", icon: Calendar, path: "/appointments", badge: "Nouveau" },
            { title: "Consultations", icon: Stethoscope, path: "/consultations", permission: "consultation" },
            { title: "Prescriptions", icon: FileText, path: "/prescriptions", permission: "prescription" },
            { title: "Mes Patients", icon: Users, path: "/patients" }
          ]
        },
        {
          title: "DIRECTION M√âDICALE",
          items: [
            { title: "Hospitalisation", icon: Bed, path: "/hospitalization", permission: "admit_patient" },
            { title: "Plateaux Techniques", icon: Activity, path: "/technical-platforms" }
          ]
        }
      ]
    }
  },
  
  pharmacy: {
    admin: {
      sections: [
        {
          title: "G√âN√âRAL",
          items: [
            { title: "Tableau de bord", icon: BarChart, path: "/dashboard" }
          ]
        },
        {
          title: "GESTION",
          items: [
            { title: "Stock m√©dicaments", icon: Package, path: "/stock", permission: "manage_stock" },
            { title: "Commandes", icon: ShoppingCart, path: "/orders" },
            { title: "Fournisseurs", icon: Truck, path: "/suppliers" },
            { title: "Inventaire", icon: ClipboardList, path: "/inventory" }
          ]
        }
      ]
    },
    pharmacist: {
      sections: [
        {
          title: "ACTIVIT√â",
          items: [
            { title: "Dispensation", icon: Pill, path: "/dispensation", permission: "dispense_medication" },
            { title: "Ordonnances", icon: FileText, path: "/prescriptions" },
            { title: "Stock", icon: Package, path: "/stock", permission: "manage_stock" }
          ]
        }
      ]
    }
  },
  
  clinic: {
    // Similaire √† hospital mais simplifi√©
  },
  
  laboratory: {
    admin: {
      sections: [
        {
          title: "GESTION",
          items: [
            { title: "Personnel", icon: Users, path: "/staff" },
            { title: "√âquipements", icon: Activity, path: "/equipment" }
          ]
        }
      ]
    },
    lab_tech: {
      sections: [
        {
          title: "ANALYSES",
          items: [
            { title: "Pr√©l√®vements", icon: TestTube, path: "/samples" },
            { title: "R√©sultats", icon: FileText, path: "/results", permission: "validate_lab_results" }
          ]
        }
      ]
    }
  }
};
```

---

## üîÑ CONTEXTE MULTI-√âTABLISSEMENT

### MultiEstablishmentContext Am√©lior√©

```typescript
interface MultiEstablishmentContextType {
  // √âtablissement
  establishments: StaffRole[];
  currentEstablishment: StaffRole | null;
  
  // R√¥le
  availableRoles: Role[];      // ‚≠ê NOUVEAU: R√¥les disponibles
  currentRole: Role | null;     // ‚≠ê NOUVEAU: R√¥le actif
  
  // Actions
  selectEstablishment: (id: string) => void;
  switchEstablishment: (id: string) => void;
  switchRole: (role: Role) => void;  // ‚≠ê NOUVEAU: Changer de r√¥le
  
  // √âtat
  isLoading: boolean;
  selectedEstablishmentId: string | null;
  
  // Helpers
  hasMultipleRoles: boolean;   // ‚≠ê NOUVEAU: D√©tecte multi-r√¥les
  canSwitchContext: boolean;   // ‚≠ê NOUVEAU: Peut changer contexte
}
```

---

## üé® COMPOSANTS CR√â√âS

### 1. Page de S√©lection de R√¥le

```typescript
// src/pages/professional/SelectRole.tsx

export default function SelectRole() {
  const { availableRoles, switchRole } = useMultiEstablishment();
  
  return (
    <div className="grid grid-cols-2 gap-6">
      {/* Carte ADMIN */}
      <Card 
        onClick={() => switchRole('admin')}
        className="hover:border-primary cursor-pointer"
      >
        <Shield className="h-16 w-16 text-blue-600" />
        <h3>ADMIN</h3>
        <p>Gestion administrative de l'√©tablissement</p>
        <ul>
          ‚Ä¢ Gestion du personnel
          ‚Ä¢ Facturation et comptabilit√©
          ‚Ä¢ Rapports et statistiques
        </ul>
      </Card>
      
      {/* Carte M√âDECIN */}
      <Card 
        onClick={() => switchRole('doctor')}
        className="hover:border-primary cursor-pointer"
      >
        <Stethoscope className="h-16 w-16 text-green-600" />
        <h3>M√âDECIN</h3>
        <p>Activit√©s m√©dicales et soins</p>
        <ul>
          ‚Ä¢ Consultations
          ‚Ä¢ Prescriptions
          ‚Ä¢ Suivi des patients
        </ul>
      </Card>
    </div>
  );
}
```

### 2. Composant de Bascule Rapide

```typescript
// src/components/layout/RoleAndEstablishmentSwitcher.tsx

export function RoleAndEstablishmentSwitcher() {
  return (
    <div className="flex items-center gap-2 p-2">
      {/* S√©lecteur d'√©tablissement */}
      <Select onValueChange={switchEstablishment}>
        <SelectTrigger>
          <Building2 />
          <span>{currentEstablishment?.name || '√âtablissement'}</span>
        </SelectTrigger>
        <SelectContent>
          {establishments.map(est => (
            <SelectItem key={est.id} value={est.id}>
              {est.name}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
      
      {/* S√©lecteur de r√¥le */}
      {hasMultipleRoles && (
        <ToggleGroup type="single" value={currentRole}>
          <ToggleGroupItem value="admin" onClick={() => switchRole('admin')}>
            <Shield /> ADMIN
          </ToggleGroupItem>
          <ToggleGroupItem value="doctor" onClick={() => switchRole('doctor')}>
            <Stethoscope /> M√âDECIN
          </ToggleGroupItem>
        </ToggleGroup>
      )}
    </div>
  );
}
```

---

## üîß NAVIGATION DYNAMIQUE

### SidebarNav avec Sections Accord√©on

```typescript
// src/components/layout/sidebar/SidebarNav.tsx

export function SidebarNav() {
  const { currentEstablishment, currentRole } = useMultiEstablishment();
  
  // R√©cup√©rer le menu selon contexte
  const menuConfig = getMenuForContext(
    currentEstablishment?.type,
    currentRole
  );
  
  return (
    <nav>
      {menuConfig.sections.map((section) => (
        <Accordion key={section.title} type="single" collapsible>
          <AccordionItem value={section.title}>
            <AccordionTrigger className="px-3 py-2">
              <span className="text-xs font-semibold text-muted-foreground">
                {section.title}
              </span>
            </AccordionTrigger>
            <AccordionContent>
              {section.items.map((item) => (
                <NavItem
                  key={item.path}
                  href={item.path}
                  icon={item.icon}
                  badge={item.badge}
                  disabled={!hasPermission(item.permission)}
                >
                  {item.title}
                </NavItem>
              ))}
            </AccordionContent>
          </AccordionItem>
        </Accordion>
      ))}
    </nav>
  );
}
```

---

## üöÄ CAS D'USAGE

### Exemple : Dr. Jules DJEKI

```
1. Connexion ‚Üí directeur.sogara@sante.ga
   ‚Üì
2. Choix √©tablissement ‚Üí CMST SOGARA
   ‚Üì
3. Choix r√¥le:
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ   ADMIN     ‚îÇ   M√âDECIN   ‚îÇ
   ‚îÇ  (Director) ‚îÇ  (Doctor)   ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚Üì
4a. Si ADMIN s√©lectionn√©:
   Menu: Personnel, Facturation, Rapports...
   
4b. Si M√âDECIN s√©lectionn√©:
   Menu: Consultations, Prescriptions, Patients...
```

---

## ‚öôÔ∏è CONFIGURATION

### Types d'√âtablissements Support√©s

| Type | R√¥les Possibles | Menu Sp√©cifique |
|------|-----------------|-----------------|
| **hospital** | admin, doctor, nurse, lab_tech | Complet avec hospitalisation |
| **clinic** | admin, doctor, nurse | Simplifi√© sans urgences |
| **pharmacy** | admin, pharmacist | Focus stock et dispensation |
| **laboratory** | admin, lab_tech | Analyses et r√©sultats |
| **cabinet** | doctor | Minimal consultations |

### Permissions par R√¥le

| R√¥le | Permissions Typiques |
|------|---------------------|
| **admin** | manage_staff, manage_billing, view_analytics, manage_schedule |
| **doctor** | consultation, prescription, view_dmp, admit_patient |
| **nurse** | view_dmp, emergency_access, triage |
| **pharmacist** | dispense_medication, manage_stock |
| **lab_tech** | order_lab_test, validate_lab_results |

---

## üîÑ BASCULE ENTRE CONTEXTES

### Sc√©narios de Bascule

1. **Changement d'√©tablissement**
   - Garde le m√™me r√¥le si disponible
   - Sinon, demande de s√©lectionner un nouveau r√¥le

2. **Changement de r√¥le (m√™me √©tablissement)**
   - Menu se met √† jour instantan√©ment
   - Pas de rechargement de page
   - √âtat conserv√© en localStorage

3. **D√©connexion/Reconnexion**
   - Restaure le dernier contexte utilis√©
   - Si invalide, redemande s√©lection

---

## üìä √âTAT DU SYST√àME

### ‚úÖ Impl√©ment√©

- [x] Structure de menus hi√©rarchique
- [x] S√©lection √©tablissement ‚Üí r√¥le ‚Üí menu
- [x] Menus contextuels par type d'√©tablissement
- [x] Filtrage par permissions
- [x] Composant de bascule rapide
- [x] Persistance du contexte
- [x] Navigation accord√©on

### üöß √Ä Faire

- [ ] Animations de transition
- [ ] Ic√¥nes personnalis√©es par √©tablissement
- [ ] Raccourcis clavier pour bascule
- [ ] Historique de navigation
- [ ] Favoris personnalis√©s

---

## üéØ UTILISATION

### Pour les D√©veloppeurs

```typescript
// 1. Importer les helpers
import { getMenuForContext } from '@/config/menuDefinitions';
import { useMultiEstablishment } from '@/contexts/MultiEstablishmentContext';

// 2. R√©cup√©rer le contexte
const { currentEstablishment, currentRole } = useMultiEstablishment();

// 3. Obtenir le menu
const menu = getMenuForContext(
  currentEstablishment?.type,
  currentRole
);

// 4. V√©rifier les permissions
const canAccess = hasPermission('manage_staff');
```

### Pour Ajouter un Nouveau Type d'√âtablissement

```typescript
// Dans menuDefinitions.ts
MENU_DEFINITIONS.nouveau_type = {
  admin: {
    sections: [
      // D√©finir les sections admin
    ]
  },
  role_specifique: {
    sections: [
      // D√©finir les sections du r√¥le
    ]
  }
};
```

---

## üìù CONCLUSION

L'architecture des menus hi√©rarchiques permet une navigation contextuelle et intuitive :

- ‚úÖ **Flexible** : S'adapte √† tout type d'√©tablissement
- ‚úÖ **S√©curis√©** : Respecte les permissions
- ‚úÖ **Intuitif** : Navigation claire et structur√©e
- ‚úÖ **Performant** : Chargement dynamique des menus
- ‚úÖ **√âvolutif** : Facile d'ajouter de nouveaux types/r√¥les

**Le syst√®me est pr√™t pour la production !** üöÄ

---

**Fin du rapport**  
*Version 1.0 - 31 octobre 2025*
